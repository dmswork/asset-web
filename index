<!DOCTYPE html>
<html lang="id">
<head>
  <meta charset="UTF-8">
  <title>Asset Cordela Inn Palembang</title>
  <meta name="viewport" content="width=device-width, initial-scale=1">

  <!-- Bootstrap CDN -->
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet">

  <style>
    body {
      background-color: #f4f6f9;
    }
    .asset-card {
      max-width: 600px;
      margin: 40px auto;
    }
    .badge-kondisi {
      font-size: 0.9rem;
      padding: 6px 10px;
    }
  </style>
</head>
<body>

<div class="container">
  <div class="card asset-card shadow">
    <div class="card-header bg-primary text-white">
      <h5 class="mb-0">ðŸ“¦ Detail Asset Barang</h5>
    </div>
    <div class="card-body" id="data">
      <p class="text-muted">Memuat data aset...</p>
    </div>
  </div>
</div>

<script>
/* =============================
   AMBIL ASSET ID DARI URL
============================= */
const params = new URLSearchParams(window.location.search);
const assetId = (params.get('id') || "").trim().toUpperCase();

/* =============================
   MAP PREFIX â†’ CSV GOOGLE SHEET
============================= */
const sheetMap = {
  HK:  "https://docs.google.com/spreadsheets/d/e/2PACX-1vRrCSj8LkK4jgexXAggrcwR8T9dg4vgRCq2HWMBVbDaWzo5cZXanwUJpFwGVMhjVjOPygZ4XUHb3CSq/pub?gid=0&output=csv",
  FP:  "https://docs.google.com/spreadsheets/d/e/2PACX-1vRrCSj8LkK4jgexXAggrcwR8T9dg4vgRCq2HWMBVbDaWzo5cZXanwUJpFwGVMhjVjOPygZ4XUHb3CSq/pub?gid=1802188553&output=csv",
  FB:  "https://docs.google.com/spreadsheets/d/e/2PACX-1vRrCSj8LkK4jgexXAggrcwR8T9dg4vgRCq2HWMBVbDaWzo5cZXanwUJpFwGVMhjVjOPygZ4XUHb3CSq/pub?gid=130752718&output=csv",
  IT:  "https://docs.google.com/spreadsheets/d/e/2PACX-1vRrCSj8LkK4jgexXAggrcwR8T9dg4vgRCq2HWMBVbDaWzo5cZXanwUJpFwGVMhjVjOPygZ4XUHb3CSq/pub?gid=1268094999&output=csv",
  EG:  "https://docs.google.com/spreadsheets/d/e/2PACX-1vRrCSj8LkK4jgexXAggrcwR8T9dg4vgRCq2HWMBVbDaWzo5cZXanwUJpFwGVMhjVjOPygZ4XUHb3CSq/pub?gid=1350866735&output=csv",
  ACT: "https://docs.google.com/spreadsheets/d/e/2PACX-1vRrCSj8LkK4jgexXAggrcwR8T9dg4vgRCq2HWMBVbDaWzo5cZXanwUJpFwGVMhjVjOPygZ4XUHb3CSq/pub?gid=719158736&output=csv"
};

/* =============================
   LINK EKSTERNAL
============================= */
const formKerusakan = "https://forms.gle/Y5fvaEwtPRr689q88";
const sheetBarang   = "https://docs.google.com/spreadsheets/d/1mHwb-hMGIFHoO9qBteIQlMC-Nb4WACVnkxmjpwvaMR4/edit?usp=sharing";

/* =============================
   BADGE KONDISI
============================= */
function badgeKondisi(text) {
  text = (text || "").toLowerCase();

  if (text.includes("baik"))
    return `<span class="badge bg-success badge-kondisi">Baik</span>`;
  if (text.includes("rusak"))
    return `<span class="badge bg-danger badge-kondisi">Rusak</span>`;
  if (text.includes("perbaikan"))
    return `<span class="badge bg-warning text-dark badge-kondisi">Perbaikan</span>`;

  return `<span class="badge bg-secondary badge-kondisi">${text || "-"}</span>`;
}

/* =============================
   VALIDASI ASSET ID
============================= */
if (!assetId) {
  document.getElementById("data").innerHTML =
    `<div class="alert alert-danger">Asset ID tidak ditemukan</div>`;
} else {

  const prefix = assetId.split("-")[0]; // HK, IT, EG, dll
  const sheetURL = sheetMap[prefix];

  if (!sheetURL) {
    document.getElementById("data").innerHTML =
      `<div class="alert alert-danger">Prefix aset tidak dikenali</div>`;
  } else {

    fetch(sheetURL)
      .then(r => r.text())
      .then(csv => {
        const rows = csv.split(/\r?\n/);
        let found = false;

        for (let i = 1; i < rows.length; i++) {
          if (!rows[i].trim()) continue;

          const col = rows[i].split(",");
          const sheetId = (col[0] || "").trim().toUpperCase();

          if (sheetId === assetId) {
            found = true;

            document.getElementById("data").innerHTML = `
              <table class="table table-bordered">
                <tr><th width="35%">ID Asset</th><td>${col[0]}</td></tr>
                <tr><th>Nama Barang</th><td>${col[1] || "-"}</td></tr>
                <tr><th>Kategori</th><td>${col[2] || "-"}</td></tr>
                <tr><th>Lokasi</th><td>${col[3] || "-"}</td></tr>
                <tr><th>Kondisi</th><td>${badgeKondisi(col[4])}</td></tr>
                <tr>
                    <th>QR Code</th>
                    <td class="text-center">
                      <img 
                        src="https://api.qrserver.com/v1/create-qr-code/?size=200x200&data=${encodeURIComponent(col[6])}"
                        alt="QR Aset"
                        class="img-fluid border rounded"
                      >
                    </td>
                  </tr>

              </table>

              <div class="d-grid gap-2 mt-3">
                <a href="${formKerusakan}" target="_blank" class="btn btn-outline-danger">
                  ðŸš¨ Laporkan Kerusakan
                </a>
                <a href="${sheetBarang}" target="_blank" class="btn btn-outline-primary">
                  ðŸ“‹ Daftar Barang
                </a>
              </div>
            `;
            break;
          }
        }

        if (!found) {
          document.getElementById("data").innerHTML =
            `<div class="alert alert-warning">Aset tidak ditemukan</div>`;
        }
      })
      .catch(() => {
        document.getElementById("data").innerHTML =
          `<div class="alert alert-danger">Gagal memuat data</div>`;
      });

  }
}
</script>

</body>
</html>
